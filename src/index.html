<!DOCTYPE html>
<html>

<head>
  <title>The map</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="./leaflet-search.src.css"/>

  <style>
        #map {
            /* size of map */
            height: 500px;
            width: 800px;
        }

        .leaflet-marker-pane
        {
          visibility: hidden;
        }
        .leaflet-shadow-pane
        {
          visibility: hidden;
        }
  </style>

</head>

<body>
  <div id = "map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="./leaflet-search.src.js"></script>

  <!-- Κάναμε copy-paste τα περιεχόμενα του JSON starting_pois.json σε μια μεταβλητή (την const POIs) & με αυτό το script τη φορτώνουμε -->
  <script src="./POIs.js"></script>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      // 
      // Create map
      // 
      var map = new L.Map('map', {zoom: 15, center: [38.2370706, 21.7345796] });            // set view
      map.addLayer(new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'));  // base layer

      // 
      // Markers Layers
      // 
      var markersLayer = new L.LayerGroup();
      
      map.addLayer(markersLayer);

      // 
      // Search Bar
      // 
      var controlSearch = new L.Control.Search({
        position:'topright',
        layer: markersLayer,
        initial: true,
        zoom: 25,
        marker: false,
        autoResize: true
      }).on('search:locationfound', function (e) {
          console.log(e);

          // result 
          var title = e.text;
          var marker = e.layer;

          // ===================
          // Make marker visible
          // ===================

          // all possible html-elements that are markers
          var markers = document.getElementsByClassName('leaflet-interactive');

          // Αναζήτηση για το marker που έχει τίτλο 'title'
          for (i in markers)
          {
            // αν το βρούμε
            if (markers[i].title == title)
            {
              // το κάνουμε ορατό
              markers[i].style.visibility = 'visible';
            }
          }
      });

      map.addControl(controlSearch);

      /*=======================
            Add markers
      ========================*/

      for(i in POIs) {
        var title   = POIs[i].name;                                             // value searched
        var coord   = POIs[i].coordinates;                                      // position found
        var marker  = new L.Marker([coord.lat, coord.lng], {title: title});     // property searched
        var visits  = 1;
        marker.bindPopup(title);
        marker.on('click', clickMarker);

        function clickMarker(event) {
          this.getPopup().setLatLng(event.latlng).setContent('Πρόβλεψη Επισκεψιμότητας: ' + visits);
        }

        markersLayer.addLayer(marker);
      }
    });


// /* Create Plateia Gewrgiou marker */
// var marker2 = L.marker ([38.246242, 21.7350847], { draggable: "true", title: "Plateia Gewrgiou"});
// marker2.addTo(searcheableMarkersLayer);

// /*popup*/
// marker2.bindPopup("<b>Πλατεία Γεωργίου</b><br>Ektimisi episk");
// marker2.on("click", clickMarker);

  </script>
</body>
</html>